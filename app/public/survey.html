<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Friend Finder | Survey</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <!-- <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.1.2/cerulean/bootstrap.min.css" rel="stylesheet" integrity="sha384-EmRcsPP774S9MOi4ywB+JXUWjYnBdyInMzG2XsC5siZEUpexqxOMJW358dCYEjPu" crossorigin="anonymous"> -->
    <!-- <link rel="stylesheet" type="text/css" href="./assets/css/style.css"> -->
</head>

<body>
    <div class="container">
        <form>
            <legend>Friend Finder Survey!</legend>
            <div class="form-group">
                <label for="name">Name (Required)</label>
                <input type="text" class="form-control" id="name" placeholder="Name">
            </div>
            <div class="form-group">
                <label for="photo">Link to Photo Image</label>
                <input type="text" class="form-control" id="photo" placeholder="Photo">
            </div>
            <div class="form-group">
                <label for="name">You prefer to have a dog at your house.</label>
                <select class="form-control questions" id="question1">
                    <option value="" disabled selected>Select an option!</option>
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">You think that cereal should be poured first, and not milk.</label>
                <select class="form-control questions" id="question2">
                    <option value="" disabled selected>Select an option!</option>
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">You have some sort of religious belief system.</label>
                <select class="form-control questions" id="question3">
                    <option value="" disabled selected>Select an option!</option>
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">You like pineapple on your pizza.</label>
                <select class="form-control questions" id="question4">
                    <option value="" disabled selected>Select an option!</option>
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">You think that tattoos are unacceptable in the workplace.</label>
                <select class="form-control questions" id="question5">
                    <option value="" disabled selected>Select an option!</option>
                    option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">You prefer liquor to beer.</label>
                <select class="form-control questions" id="question6">
                    <option value="" disabled selected>Select an option!</option>
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">You think that intelligence is more attractive than just outward appearances.</label>
                <select class="form-control questions" id="question7">
                    <option value="" disabled selected>Select an option!</option>
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">You regularly challenge yourself to try new things.</label>
                <select class="form-control questions" id="question8">
                    <option value="" disabled selected>Select an option!</option>
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">You liked the Star Wars prequel trilogy.</label>
                <select class="form-control questions" id="question9">
                    <option value="" disabled selected>Select an option!</option>
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">You agreed with the outcome of the last U.S. presidential election.</label>
                <select class="form-control questions" id="question10">
                    <option value="" disabled selected>Select an option!</option>
                    <option>1 (Strongly Disagree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <button type="submit" class="btn btn-default submit survey-btn" data-toggle="modal" data-target="#myModal">Submit</button>
        </form>

        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <!-- <span aria-hidden="true">&times;</span> -->
                        </button>
                        <h4 class="modal-title" id="myModalLabel">Your Best Match!</h4>
                    </div>

                    <div class="modal-body" id="bestMatch">
                        <h2 class="text-center" id="myMatchName"></h2>
                        <img id="myMatchImg" class="img-responsive center-block" style="height:200px" alt="Responsive image">
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container" id="footer-text">
            <br>
            <p class="text-muted">
                <a href="/">Home</a> |
                <a href="/api/friends" target="_blank">API Friends List</a> |
                <a href="https://github.com/rherd/FriendFinder" target="_blank">GitHub Repo</a>
            </p>
        </div>
    </footer>


    <script src="https://code.jquery.com/jquery-3.1.1.js"></script>
    <!-- have to use 3.3.7 because v4 doesn't handle modal fade in properly -->
    <!-- using this for the modal fade in piece -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--*****************************************-->
    <!-- BELOW CODE HANDLES HOW FORM DATA IS SENT TO & RETRIEVED FROM THE SERVER-->
    <script type="text/javascript">

        $(window).on("load", (function () {
            // Run code
            $("#name").val("");
            $("#photo").val("");
            $("#question1").val("");
            $("#question2").val("");
            $("#question3").val("");
            $("#question4").val("");
            $("#question5").val("");
            $("#question6").val("");
            $("#question7").val("");
            $("#question8").val("");
            $("#question9").val("");
            $("#question10").val("");
        }));
        // VARIABLES
        var diffArr = [];
        var compArr = [];
        var friend;
        /**********************************************/
        // FUNCTIONS
        // Start up function to get the friends list from the friends api
        var start = function () {
            // Getting the location of the root page
            var currentURL = window.location.origin;
            // destroy array of comparisons
            compArr.length = 0;
            // Using a GET command to get the the friends list
            $.get(currentURL + "/api/friends", function (friendArr) {
                for (var i = 0; i < friendArr.length; i++) {
                    console.log(friendArr[i].name);
                }
                // Calling the calcDiff() to perform our difference calculations between my answers to the survey and the data stored in the api
                calcDiff(friendArr);
            });
        };


        var calcDiff = function (friendArr) {
            // myAnswers will be the last object in the array of friends, since we pushed it below
            var myAnswers = friendArr[friendArr.length - 1];
            // start with the first friend list, loop through until the end, store each object in eachFriend so we can perform operations on it
            for (var i = 0; i < friendArr.length - 1; i++) {
                eachFriend = friendArr[i];
                // use findMatch to calculate differences between the chosen friend and myAnswers
                var findMatch = function (eachFriend) {
                    // for each score
                    for (var i = 0; i < myAnswers.scores.length; i++) {
                        //store the difference between my score per question and the chosen eachFriend in this run
                        diffArr[i] = Math.abs(parseInt(myAnswers.scores[i]) - parseInt(eachFriend.scores[i]));
                    }
                    // log the answers for refenerence/testing
                    console.log(eachFriend.name + "'s Diffs: " + diffArr);
                    // sum the total difference using reduce on the array
                    var sum = diffArr.reduce(add, 0);
                    // function to return the sum 
                    function add(a, b) {
                        return a + b;
                    }
                    // log the sum of the values
                    console.log(sum);
                    // push  the sum to our comparison array
                    compArr.push(sum);
                };
                // call above findMatch function
                findMatch(eachFriend);
            }
            // Logging the array of total scores for comparison
            console.log(compArr);


            // find the min score using min.apply, not sure if this is the best way to do it or not
            var minScore = Math.min.apply(Math, compArr);
            // index friendArr to find the index of the minScore - this will be the friend we match with
            var matchName = friendArr[compArr.indexOf(minScore)].name;
            //grab the photo from the friendArr as well
            var matchPhoto = friendArr[compArr.indexOf(minScore)].photo;
            // console log for reference
            console.log(minScore);
            console.log(matchName);
            // put these back in the DOM using jquery
            $("#myMatchName").text(matchName);
            $("#myMatchImg").attr("src", matchPhoto);
        };
        /**********************************************/
        // Submit/Fire
        // click even on submit fires the functions listed above
        $(".submit").on("click", function (event) {
            // Get location of origin
            var currentURL = window.location.origin;

            event.preventDefault();
            // grab elements from new entry

            //validate that the user entered a valid value in each field.

            if (!$("#name").val()) {
                $("#name").val("Please enter a name!");
                $("#myMatchName").text("Please enter a name!");
                $("#myMatchImg").hide();
            }
            else if (!$("#photo").val()) {
                $("#photo").val("Please enter a URL!");
                $("#myMatchName").text("Please enter a URL!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question1").val()) {
                $("#question1").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 1!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question2").val()) {
                $("#question2").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 2!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question3").val()) {
                $("#question3").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 3!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question4").val()) {
                $("#question4").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 4!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question5").val()) {
                $("#question5").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 5!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question6").val()) {
                $("#question6").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 6!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question7").val()) {
                $("#question7").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 7!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question8").val()) {
                $("#question8").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 8!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question9").val()) {
                $("#question9").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 9!");
                $("#myMatchImg").hide();
            }
            else if (!$("#question10").val()) {
                $("#question10").val("Please pick an option below!");
                $("#myMatchName").text("Please select an option for question 10!");
                $("#myMatchImg").hide();
            }
            else {

                var addEntry = {
                    name: $("#name").val().trim(),
                    photo: $("#photo").val().trim(),
                    scores: [
                        $("#question1").val().trim(),
                        $("#question2").val().trim(),
                        $("#question3").val().trim(),
                        $("#question4").val().trim(),
                        $("#question5").val().trim(),
                        $("#question6").val().trim(),
                        $("#question7").val().trim(),
                        $("#question8").val().trim(),
                        $("#question9").val().trim(),
                        $("#question10").val().trim()
                    ]
                };


                // console new entry for reference
                console.log(addEntry);
                // post submitted entry to the api friends list
                $.post(currentURL + "/api/friends", addEntry,
                    function (data) {
                        // If the form is successfully submitted, find the best match
                        if (data) {
                            console.log("Form submitted.");
                            // Calling the start() function
                            start();
                        }
                        // error handling
                        else {
                            alert("Uh oh. Something happened.");
                        }
                        // Clearing the form when submitting
                        $("#name").val("");
                        $("#photo").val("");
                        $("#question1").val("");
                        $("#question2").val("");
                        $("#question3").val("");
                        $("#question4").val("");
                        $("#question5").val("");
                        $("#question6").val("");
                        $("#question7").val("");
                        $("#question8").val("");
                        $("#question9").val("");
                        $("#question10").val("");
                    }
                );
            }
        });
    </script>
    <style>
        body {
            background-color: #e95e0e !important;
        }

        .survey-btn {
            background-color: #0d51e4;
        }

        .questions {
            width: 180px;
        }

        .survey-btn {
            color: white;
        }

        .text-muted {
            background-color: white !important;
            width: 250px;
            border-style: solid;
            border-width: medium;
            border-radius: 5px 5px 5px 5px;
            border-color: blue;          
        }
    </style>
</body>

</html>